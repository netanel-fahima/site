<div class="section section-padding checkout">
  <div class="container wrap">


    <div class="checkout-coupon">
      <p class="coupon-toggle">
        <a href="#checkout-coupon-form" data-toggle="collapse" class="collapsed"
           aria-expanded="false">
          <span *ngIf="!coupons.length">לחצי כאן להזנת קופון</span>
          <span *ngIf="coupons.length">לחצי כאן להזנת קופון נוסף</span>
        </a>
      </p>
      <div id="checkout-coupon-form" class="collapse" style="">
        <div class="coupon-form">
          <p>.אם יש לך קופון אנא הזיני אותו פה</p>
          <form action="#" class="learts-mb-n10">
            <button (click)="addCoupon()" class="btn btn-dark btn-outline-hover-dark learts-mb-10"
                    style="margin-right: 5px">אשרי קופון
            </button>
            <input class="learts-mb-10" type="text" [(ngModel)]="couponModel" placeholder="קוד קופון"
                   [ngModelOptions]="{standalone: true}">
          </form>
        </div>
      </div>
      <div *ngIf="coupons.length" class="mb-5">
        <p>קופונים שנוספו</p>
        <ul class="list-group-item-info p-2 mb-1" dir="rtl" style="list-style: none">
          <li *ngFor="let c of coupons" class="d-flex "><i class="pointer-event ml-1" title="להסרת קופון"
                                                           (click)="removeCoupon(c)">x</i>
            <p>{{c.code}}</p></li>
        </ul>
      </div>
    </div>

    <!--    <div class="section-title2">
          <h2 class="title">פרטי תשלום</h2>
        </div>-->
    <section class="d-flex flex-row-reverse flex-wrap learts-mb-30">
      <div class="text-right text-info mb-4 w-100"><p>פרטי משלוח ותשלום</p></div>
      <form action="#" class="anyflexbox" [formGroup]="form" (ngSubmit)="onSubmit($event)">
        <div class="row form-group">
          <div class="col-md-6 col-12 learts-mb-20 form-group">
            <label for="firstName">שם פרטי <abbr class="required">*</abbr></label>
            <input id="firstName" type="text" formControlName="firstName" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.firstName.errors }"/>
            <div *ngIf="submitted && f.firstName.errors" class="invalid-feedback">
              <div *ngIf="f.firstName.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-md-6 col-12 learts-mb-20 form-group">
            <label for="lastName">שם משפחה <abbr class="required">*</abbr></label>
            <input id="lastName" type="text" formControlName="lastName" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.lastName.errors }"/>
            <div *ngIf="submitted && f.lastName.errors" class="invalid-feedback">
              <div *ngIf="f.lastName.errors.required">שדה נדרש</div>
            </div>
          </div>

          <div class="col-md-6 col-12 learts-mb-20 form-group">
            <label for="bdAddress2"> כניסה , דירה </label>
            <input id="bdAddress2" type="text" formControlName="bdAddress2" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.bdAddress2.errors }"/>
            <div *ngIf="submitted && f.bdAddress2.errors" class="invalid-feedback">
              <div *ngIf="f.bdAddress2.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-md-6 col-12 learts-mb-20 form-group">
            <label for="bdAddress1">כתובת <abbr class="required">*</abbr></label>
            <input id="bdAddress1" type="text" formControlName="bdAddress1" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.bdAddress1.errors }"/>
            <div *ngIf="submitted && f.bdAddress1.errors" class="invalid-feedback">
              <div *ngIf="f.bdAddress1.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-12 learts-mb-20 form-group">
            <label for="city">עיר <abbr class="required">*</abbr></label>
            <input id="city" type="text" formControlName="city" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.city.errors }"/>
            <div *ngIf="submitted && f.city.errors" class="invalid-feedback">
              <div *ngIf="f.city.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-12 learts-mb-20 form-group">
            <label for="postal">מיקוד (לא חייב) </label>
            <input id="postal" type="text" formControlName="postal" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.postal.errors }"/>
            <div *ngIf="submitted && f.postal.errors" class="invalid-feedback">
              <div *ngIf="f.postal.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-md-6 col-12 learts-mb-20 form-group">
            <label for="email">אמייל <abbr class="required">*</abbr></label>
            <input id="email" type="text" formControlName="email" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.email.errors }"/>
            <div *ngIf="submitted && f.email.errors" class="invalid-feedback">
              <div *ngIf="f.email.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-md-6 col-12 learts-mb-30 form-group">
            <label for="phone">טלפון <abbr class="required">*</abbr></label>
            <input id="phone" type="text" formControlName="phone" class="form-control"
                   [ngClass]="{ 'is-invalid': submitted && f.phone.errors }"/>
            <div *ngIf="submitted && f.phone.errors" class="invalid-feedback">
              <div *ngIf="f.phone.errors.required">שדה נדרש</div>
            </div>
          </div>
          <div class="col-12 learts-mb-40 form-group" *ngIf="!(data.users$|async)">
            <div class="form-check">
              <label class="form-check-label" for="createUser">?צור משתמש</label>
              <input style="height: 20px" type="checkbox" name="createUser" class="form-check-input"
                     formControlName="createUser" checked
                     id="createUser">
              <div *ngIf="submitted && f.createUser.errors" class="invalid-feedback">
                <div *ngIf="f.createUser.errors.required">נדרש יצירת משתמש!</div>
              </div>
            </div>
          </div>
          <div class="col-12 learts-mb-20 form-group">
            <label for="note"></label>
            <textarea id="note" dir="rtl" placeholder=".הערות לגבי המוצר והמשלוח" name="note"
                      formControlName="note"></textarea>
          </div>
        </div>
        <div class="m-3 bg-danger text-white" *ngIf="(autError$ | async).r">
          <div [innerHTML]="(autError$|async).r"></div>
        </div>
        <div class="m-3 bg-danger text-white" *ngIf="(orderError$ | async)">
          <div [innerHTML]="(orderError$|async)"></div>
        </div>
        <div class="m-3 bg-danger text-white" *ngIf="submitted && !payMethod">
          <p>{{ 'בחרי אמצאי תשלום' }}</p>
        </div>
        <div class="col-lg-12 order-lg-1 learts-mb-10 border-info d-flex flex-column"
             style="margin-left: auto;margin-bottom: 2rem"
             dir="rtl">
          <div class="form-check">
            <label class="col-form-label-sm" for="deliveryMethod">שיטת משלוח</label>
            <select formControlName="deliveryMethod"
                    (ngModelChange)="addDelivery($event)"
                    name="deliveryMethod" id="deliveryMethod" class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f.deliveryMethod.errors }">
              <option></option>
              <option *ngFor="let shippingMethod of shippingMethods$|async "
                      [value]="shippingMethod.id">{{shippingMethod.title}}</option>
            </select>
            <div *ngIf="submitted && f.deliveryMethod.errors" class="invalid-feedback">
              <div *ngIf="f.deliveryMethod.errors.required">בחר שיטת משלוח!</div>
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-sm-around flex-wrap btn-group-lg">
          <button class="btn btn-info btn-outline-hover-dark" value="bit">תשלום בביט</button>
          <button class="btn bg-primary3 btn-outline-hover-dark btn-hover-light" value="phonePayment">תשלום טלפוני
          </button>
          <button class="btn btn-secondary btn-outline-hover-dark" value="credit">תשלום באשראי</button>
        </div>
        <div class="pay-icons"></div>
        <div class="m-3 bg-info text-white text-center" *ngIf="(orderLoad$ | async)">
          <p>טוען הזמנה!</p>
        </div>

      </form>

      <aside class="sidebar">
        <div class=" order-lg-2 learts-mb-30">
          <div class="order-review">
            <table class="table">
              <thead>
              <tr>
                <th class="total">סך הכל</th>
                <th class="name">מוצר</th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let o of data.cart$ |async">
                <td class="total"><span>{{o.product.price | currency}}</span></td>
                <td class="name">{{o.product.name}}&nbsp; <strong class="quantity">×&nbsp;{{o.quantity}} </strong></td>
              </tr>
              </tbody>
              <tfoot>
              <tr class="subtotal">
                <td><span>{{(data.delivery$ |async)?.settings?.cost?.value | currency}}</span></td>
                <th>משלוח</th>
              </tr>
              <tr class="subtotal">
                <td><span>{{data.totalCart() |async| currency}}</span></td>
                <th>מחיר</th>
              </tr>
              <tr class="subtotal" *ngIf="order && coupons.length">
                <td>
                  <strong>
                    <span>{{((data.totalCart(true) |async) - order.total)|currency}}</span>
                  </strong>
                </td>
                <th><span *ngIf="order && coupons.length">הנחה</span></th>
              </tr>
              <tr class="total">
                <td>
                  <strong>
                    <span>{{order ? (order.total | currency) : data.totalCart(true) |async | currency}}</span>
                  </strong>
                </td>
                <th> סה"כ <span *ngIf="order && coupons.length">לאחר קופון</span></th>
              </tr>
              </tfoot>
            </table>
          </div>
          <div class="text-center">
            <p class="payment-note">הנתונים האישיים שלך ישמשו לעיבוד הזמנתך, לתמיכה בחווייתך ברחבי אתר זה ולמטרות אחרות
              המתוארות במדיניות הפרטיות שלנו.</p>
          </div>
        </div>
      </aside>
    </section>
  </div>
</div>
